

# 一、系统整体架构

## 1. 系统架构整体分析

系统主要遇到的问题：

**1 web服务器压力大：**

- web服务器要，要应对每一个请求，要进行安全验证。
- 对于每个请求他都要不断地读取数据库。
- **高并发**：在大量请求下他会导致数据的一致性无法保证。

<img src="pic/9%E7%AB%A0.assets/image-20221026141634858.png" alt="image-20221026141634858" style="zoom:25%;" />



## 2. 调整以后的架构：秒杀分布式架构

1. 用户请求的静态资源淡出存储在CDN里面
2. 用户请求会先到达SLB：不知道是什么流量负载均衡
3. 请求会先通过 **分布式安全验证** 进行安全拦截：看用户是否有权限、请求是否安全
4. **秒杀数量控制**：查看商品数量，进行秒杀数量控制
5. 通过以上筛选后的请求才进入web服务
6. RabbitMQ：当访问请求过多时，会临时将请求存入管道排队，防止暴库。
7. 最后，rabbitMQ挨个将请求放入MySQL

<img src="pic/9%E7%AB%A0.assets/image-20221026142746215.png" alt="image-20221026142746215" style="zoom: 25%;" />



# 二、前端优化

- 实现页面静态化
- CDN部署

<img src="pic/9%E7%AB%A0.assets/image-20221026145550676.png" alt="image-20221026145550676" style="zoom:25%;" />

## 1. 页面静态化



### 1.1 为什么要进行页面静态化

**动态网站**：网站会随着内容的不同实时的展现出不同

**静态网站**：如果没有多余的请求，展现静态页面速度快

<img src="pic/9%E7%AB%A0.assets/image-20221026151308930.png" alt="image-20221026151308930" style="zoom:25%;" />

为什么要页面静态化？

1. 减轻服务器的负担：
    - 动态网站需要请求服务器来生成动态网站



### 1.2 页面静态化有哪些方式

<img src="pic/9%E7%AB%A0.assets/image-20221026151548342.png" alt="image-20221026151548342" style="zoom:25%;" />

1. 直接将html文件放在Nginx上
2. Go代码实现



## 2. 问题

生成静态文件访问了数据库，是不是访问速度会受到影响呢？

Answer：

**不会**。因为访问数据库是生成模板，数据库内的内容是不断变化的，因此要重新生成静态模板。

但每次请求不会走到这一步，只能访问请求静态文件，然后返回静态文件给前端用户。相当于是说，生成模板是一个controller，请求静态文件是另一部分。
