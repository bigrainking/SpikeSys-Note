# 一、MQ架构的常见问题

## 1. 常见问题？



#### 1. 如何保证消息不丢失？

如果MQ服务器宕机之后，如何保证消息不丢失？

- **持久化机制**

   MQ服务器会将消息缓存，放在硬盘。因此即使Server宕机，也不会丢失消息

<img src="pic/4MQ%E6%9E%B6%E6%9E%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.assets/image-20220727102213908.png" alt="image-20220727102213908" style="zoom:33%;" />



#### 2. 消费者不在时，MQ中的消息是否会丢失？

- **不会**

- **消息确认机制：** 必须要消费者成功消费了这个消息之后， 才会通知到MQ服务器删除消息。因此， 消费者不在时候

当消费者不在的情况在，消息会一直缓存在MQ中，消息不会因为消费者不在而丢失

<img src="pic/4MQ%E6%9E%B6%E6%9E%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.assets/image-20220727102412005.png" alt="image-20220727102412005" style="zoom:33%;" />



#### 3. MQ推送消息，与消费者主动拉取消息有什么区别？

- MQ主动推送消息：说明消费者与Server保持着长连接
- 消费者主动拉取消息：说明消费者还处在刚刚启动的时候，还没建立连接

<img src="pic/4MQ%E6%9E%B6%E6%9E%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.assets/image-20220727102624869.png" alt="image-20220727102624869" style="zoom:33%;" />

## 2. 如何实现抗高并发？



#### 1. 默认情况

MQ消费者在默认情况下，会拉取MQ服务器的消息进行消费。 但默认情况下是拉取一条消息。

**缺点**：存在延迟的问题



#### 2.如何解决MQ消息堆积问题？

对于上面的默认情况，会导致MQ消息堆积在MQ服务器。 那么需要提高消费者的速率， 如何提高捏？

- 提高消费者速率：消费者实现集群：创建多个消费者
- 消费者批量获取消息

<img src="pic/4MQ%E6%9E%B6%E6%9E%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.assets/image-20220727104439052.png" alt="image-20220727104439052" style="zoom:33%;" />